<button
  mat-button
  routerLink="/app/account/profile"
  class="back-btn"
>
  <mat-icon>arrow_back</mat-icon>
  Retour au profil
</button>


<mat-card class="order-card" *ngIf="order$ | async as order">

  <mat-card-subtitle>
  <mat-icon>event</mat-icon>
  {{ order.createdAt | date:'longDate' }}
</mat-card-subtitle>
  
 <p class="status">
  <mat-icon color="primary">
    {{ order.status === 'delivered'
        ? 'check_circle'
        : order.status === 'shipped'
        ? 'local_shipping'
        : 'payments' }}
  </mat-icon>

  <strong>
    {{
      order.status === 'paid'
        ? 'Payée'
        : order.status === 'shipped'
        ? 'Expédiée'
        : 'Livrée'
    }}
  </strong>
</p>



<mat-divider></mat-divider>

  <mat-card-content>

    <!-- PRODUITS -->
    <h3>
      <mat-icon>shopping_cart</mat-icon>
      Produits
    </h3>

    <mat-list *ngIf="order.items.length > 0">
      <mat-list-item *ngFor="let item of order.items">
        <mat-icon matListIcon>inventory_2</mat-icon>
        <div>
          <strong>{{ item.name }}</strong><br />
          {{ item.quantity }} × {{ item.price }} €
        </div>
        <span class="price">
          {{ item.quantity * item.price }} €
        </span>
      </mat-list-item>
    </mat-list>

    <p *ngIf="order.items.length === 0">
      Aucun produit dans cette commande.
    </p>
    <!-- PROMOTIONS -->
<div *ngIf="order.promo as promo">
  <mat-divider></mat-divider>

  <h3>
    <mat-icon>local_offer</mat-icon>
    Promotion
  </h3>

  <p *ngIf="promo.appliedPromos.length > 0">
    Code(s) appliqué(s) :
    <strong>
      <span *ngFor="let code of promo.appliedPromos; let last = last">
        {{ code }}<span *ngIf="!last">, </span>
      </span>
    </strong>
  </p>

  <p *ngIf="promo.discount > 0">
    Remise : −{{ promo.discount | number:'1.2-2' }} €
  </p>

  <p>
    Livraison : {{ promo.shipping }} €
  </p>

  <p>
    Taxes : {{ promo.taxes | number:'1.2-2' }} €
  </p>
</div>



    <mat-divider></mat-divider>

    <!-- TOTAUX -->
    <div class="totals">
      
      <p class="total">
        Total : {{ order.total }} €
      </p>
      <p>
        Paiement : <strong>{{ order.paymentMethod }}</strong>
      </p>
    </div>

  </mat-card-content>

</mat-card>

<p *ngIf="loading$ | async">Chargement…</p>
