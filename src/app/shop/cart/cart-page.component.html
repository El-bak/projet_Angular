<div class="back-container">
  <button class="back-btn" routerLink="/app/shop/products" >‚Üê Back</button>
</div>

<div class="cart-page">
  <h2>Votre Panier</h2>

  <div *ngIf="items$ | async as items; else emptyCart">
    
    <div class="items-list">
      <app-cart-item *ngFor="let it of items"
        [item]="it"
        (remove)="removeItem(it.productId)"
        (quantityChange)="updateQuantity(it.productId, $event)">
      </app-cart-item>
    </div>

    <div class="subtotal">
      <span>Total :</span> <strong>{{ total$ | async }} ‚Ç¨</strong>
    </div>
    
    <p class="error" *ngIf="stockError$ | async as err">
     ‚ö†Ô∏è {{ err }}
    </p>
    
    <button
      class="checkout-btn"
      [disabled]="!(canCheckout$ | async)"
      (click)="checkout()"
    >
    Passer √† la caisse
    </button>

  </div>

  <ng-template #emptyCart>
    <p>Votre panier est vide.</p>
  </ng-template>
</div>
<div class="coupon-box">
  <h3>üéü Code promo</h3>

  <input
    placeholder="Code promo"
    [(ngModel)]="couponCode"
  />

  <button (click)="applyPromo()">Appliquer</button>

  <p class="error" *ngIf="promoError$ | async as err">
    ‚ö†Ô∏è {{ err }}
  </p>

  <!-- ‚úÖ TOTAL FINAL BACKEND -->
  <p *ngIf="promoTotals$ | async as t">
    Total final :
    <strong>{{ t.grandTotal }} ‚Ç¨</strong>
  </p>
</div>

